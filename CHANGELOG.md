# 版本更新日志 (CHANGELOG)
## v0.8.1 (2026-01-16) ✨ 功能增强版 - TTS自动检测+命令行参数动态开关+无缝降级
### 核心升级亮点
- ✅ **TTS服务自动存活检测**：程序启动自动TCP检测 `127.0.0.1:9666` 端口，超时1秒；服务离线则**自动静默关闭TTS功能**，无报错、无缝降级，不影响程序运行
- ✅ **命令行参数动态开关**：彻底替代硬编码宏定义，无需修改源码/重新编译，一行命令控制所有功能，支持参数组合：
  - `-ntts`：手动强制关闭TTS（优先级最高，跳过检测）
  - `-nsound`：关闭Kiko消息提示音
  - `-silent`：静默模式，仅显示聊天消息，关闭所有系统日志
  - `-h/--help`：显示参数帮助信息并退出
  - `-utf8`：强制锁定UTF8编码（默认已开启）
- ✅ **开关优先级设计**：`手动命令行开关 > 自动检测结果`，满足不同场景需求
- ✅ **运行时变量重构**：将 `TTS_ENABLE/SOUND_ENABLE` 等编译期常量改为**运行时全局变量**，支持动态修改，无代码冗余
- ✅ **静默模式优化**：开启后仅保留聊天消息显示，系统日志（如节点发现、连接成功）全部隐藏，清爽运行
- ✅ **无缝兼容v0.8**：不传任何参数时，行为与v0.8完全一致，零成本升级
- ✅ **鲁棒性增强**：TTS检测失败后自动关闭功能，程序无闪退/卡死；所有全局变量修改加互斥锁，线程安全
- ✅ **资源清理优化**：退出时自动释放所有套接字、线程句柄、内存，无残留

### 底层优化
- 优化 `main` 函数入口：适配Windows x64汇编标准传参（`RCX=argc, RDX=argv`），完美支持命令行参数解析
- 新增 `TTS_Server_Check` 核心函数：基于TCP端口连通性检测，轻量化无阻塞
- 新增 `CmdLine_Parse_Args` 函数：支持大小写不敏感参数解析，逻辑清晰易扩展
- 优化日志输出逻辑：所有系统提示支持静默模式开关，避免冗余信息干扰

## v0.8 (2026-01-15) 🎙️ 功能扩展版 - 接入本地TTS语音服务器
### 核心升级亮点
- ✅ **接入本地TTS服务器**：支持调用 `http://127.0.0.1:9666/tts` 接口，收到私聊/组播消息时自动语音播报
- ✅ **中文编码完美适配**：内置 `WChar_To_UTF8` 函数，自动将UTF16宽字符中文转为UTF8编码，传给TTS服务器无乱码
- ✅ **TTS一键开关**：通过 `TTS_ENABLE` 宏定义控制，改为0即可关闭所有TTS相关功能
- ✅ **异步无阻塞播报**：调用Windows原生WinINet库发起HTTP请求，不影响聊天输入/发送流程
- ✅ **多重提醒联动**：收到消息时同步触发「TTS语音播报 + Kiko提示音 + 托盘气泡提示」
- ✅ **零额外依赖**：仅依赖系统自带WinINet库，无需安装第三方组件

## v0.7 (2026-01-14) ✨ 终极完整版 - 原生中文+全Unicode无乱码
### 核心升级亮点
- ✅ **原生完美支持UTF-8/Unicode**：彻底解决中文乱码问题，支持简体/繁体中文、日文、韩文、特殊符号
- ✅ **全量宽字符API替换**：抛弃ANSI窄字符(`xxxA`)API，全部使用Windows原生宽字符(`xxxW`)API（`wprintf/_getws_s/wcslen`等）
- ✅ **控制台编码强制锁定**：调用 `SetConsoleCP/SetConsoleOutputCP(65001)`，永久锁定UTF-8编码，中文显示零错位
- ✅ **中文深度适配**：窗口标题、系统提示、托盘气泡、输入前缀全部原生中文显示，无转码损耗
- ✅ **加宽字符缓冲区**：适配超长中文消息的存储与分片传输，与英文消息长度限制一致
- ✅ **保留v0.6全部特性**：WIN+J全局热键、托盘显隐、防广播风暴、RC4加密、TCP/UDP双协议通信，无任何删减

## v0.6 (2026-01-13) 📢 体验优化版 - 托盘气泡+提示音
- ✅ 新增：新消息托盘气泡提示（标题+消息内容，3秒自动消失）
- ✅ 新增：收到消息自动播放Kiko系统提示音（异步播放不阻塞）
- ✅ 优化：气泡提示内容包含发送节点IP+消息正文，中文友好
- ✅ 新增：提示音开关宏定义 `SOUND_ENABLED`，一键关闭/开启

## v0.5 (2026-01-12) ⌨️ 交互增强版 - 全局热键+托盘常驻
- ✅ 新增：全局快捷键 `WIN+J` 一键显示/隐藏窗口
- ✅ 新增：系统托盘常驻功能，点击托盘图标恢复窗口
- ✅ 新增：托盘悬浮提示文本，展示程序版本与快捷键说明

## v0.1-v0.4 基础版本
- ✅ 去中心化P2P局域网节点发现
- ✅ TCP点对点私聊 + UDP组播广播
- ✅ RC4流加密通信，消息安全防嗅探
- ✅ 超长消息自动分片与重组
- ✅ TCP断线自动重连机制
- ✅ 防广播风暴的随机延时策略
- ✅ 线程安全的全局资源锁，无数据竞争
